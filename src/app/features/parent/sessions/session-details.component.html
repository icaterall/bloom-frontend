<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Back Button -->
  <button (click)="goBack()" class="inline-flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6">
    <lucide-angular [img]="ArrowLeftIcon" size="18"></lucide-angular>
    <span>{{ 'common.back' | translate }}</span>
  </button>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex justify-center py-12">
    <div class="inline-flex items-center space-x-3">
      <span class="h-6 w-6 border-2 border-[#2563EB] border-t-transparent rounded-full animate-spin"></span>
      <span class="text-sm text-gray-600">{{ 'common.loading' | translate }}</span>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="bg-red-50 border border-red-200 rounded-lg p-6 mb-6">
    <div class="flex items-center gap-3">
      <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <div>
        <h3 class="font-semibold text-red-900">{{ 'sessions.details.error.title' | translate }}</h3>
        <p class="text-sm text-red-700 mt-1">{{ error }}</p>
      </div>
    </div>
  </div>

  <!-- Session Details -->
  <div *ngIf="!isLoading && !error && booking" class="space-y-6">
    <!-- Header -->
    <div class="bg-white rounded-lg border border-gray-200 p-6">
      <div class="flex items-center justify-between mb-4">
        <h1 class="text-2xl font-bold text-gray-900">{{ 'sessions.details.title' | translate }}</h1>
        <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold border" [ngClass]="getStatusColor(booking.status)">
          {{ getStatusLabel(booking.status) | translate }}
        </span>
      </div>
    </div>

    <!-- Session Information -->
    <div class="bg-white rounded-lg border border-gray-200 p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">{{ 'sessions.details.sessionInfo' | translate }}</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Child -->
        <div class="flex items-start gap-3">
          <lucide-angular [img]="UserIcon" size="20" class="text-gray-500 mt-0.5"></lucide-angular>
          <div>
            <p class="text-sm text-gray-600 mb-1">{{ 'sessions.details.child' | translate }}</p>
            <p class="text-base font-medium text-gray-900">{{ booking.child_name }}</p>
          </div>
        </div>

        <!-- Service -->
        <div class="flex items-start gap-3">
          <lucide-angular [img]="CalendarIcon" size="20" class="text-gray-500 mt-0.5"></lucide-angular>
          <div>
            <p class="text-sm text-gray-600 mb-1">{{ 'sessions.details.service' | translate }}</p>
            <p class="text-base font-medium text-gray-900">{{ booking.booking_type_name || booking.booking_type }}</p>
          </div>
        </div>

        <!-- Date & Time -->
        <div class="flex items-start gap-3">
          <lucide-angular [img]="ClockIcon" size="20" class="text-gray-500 mt-0.5"></lucide-angular>
          <div>
            <p class="text-sm text-gray-600 mb-1">{{ 'sessions.details.dateTime' | translate }}</p>
            <p class="text-base font-medium text-gray-900">
              <span *ngIf="booking.confirmed_start_at">
                {{ booking.confirmed_start_at | date:'fullDate' }} at {{ booking.confirmed_start_at | date:'shortTime' }}
                <span *ngIf="booking.confirmed_end_at" class="text-sm text-gray-500 block mt-1">
                  Until {{ booking.confirmed_end_at | date:'shortTime' }}
                </span>
              </span>
              <span *ngIf="!booking.confirmed_start_at && booking.preferred_start_at">
                {{ booking.preferred_start_at | date:'fullDate' }} at {{ booking.preferred_start_at | date:'shortTime' }}
                <span class="text-xs text-amber-600 ml-2">({{ 'sessions.details.preferred' | translate }})</span>
              </span>
            </p>
          </div>
        </div>

        <!-- Mode -->
        <div class="flex items-start gap-3">
          <lucide-angular [img]="booking.mode === 'online' ? VideoIcon : MapPinIcon" size="20" class="text-gray-500 mt-0.5"></lucide-angular>
          <div>
            <p class="text-sm text-gray-600 mb-1">{{ 'sessions.details.mode' | translate }}</p>
            <p class="text-base font-medium text-gray-900">
              {{ booking.mode === 'online' ? ('booking.mode.online' | translate) : ('booking.mode.inCentre' | translate) }}
            </p>
          </div>
        </div>

        <!-- Location or Online Link -->
        <div *ngIf="booking.mode === 'in_centre' && booking.location" class="flex items-start gap-3">
          <lucide-angular [img]="MapPinIcon" size="20" class="text-gray-500 mt-0.5"></lucide-angular>
          <div>
            <p class="text-sm text-gray-600 mb-1">{{ 'sessions.details.location' | translate }}</p>
            <p class="text-base font-medium text-gray-900">{{ booking.location }}</p>
          </div>
        </div>

        <div *ngIf="booking.mode === 'online' && booking.online_meeting_link" class="flex items-start gap-3">
          <lucide-angular [img]="VideoIcon" size="20" class="text-gray-500 mt-0.5"></lucide-angular>
          <div>
            <p class="text-sm text-gray-600 mb-1">{{ 'sessions.details.onlineLink' | translate }}</p>
            <a [href]="booking.online_meeting_link" target="_blank" rel="noopener noreferrer" class="text-[#2563EB] hover:underline font-medium">
              {{ 'sessions.details.joinSession' | translate }}
            </a>
          </div>
        </div>

        <!-- Therapist -->
        <div *ngIf="booking.therapist_name" class="flex items-start gap-3">
          <lucide-angular [img]="UserIcon" size="20" class="text-gray-500 mt-0.5"></lucide-angular>
          <div>
            <p class="text-sm text-gray-600 mb-1">{{ 'sessions.details.therapist' | translate }}</p>
            <p class="text-base font-medium text-gray-900">{{ booking.therapist_name }}</p>
          </div>
        </div>

        <!-- Price -->
        <div *ngIf="booking.price" class="flex items-start gap-3">
          <lucide-angular [img]="CreditCardIcon" size="20" class="text-gray-500 mt-0.5"></lucide-angular>
          <div>
            <p class="text-sm text-gray-600 mb-1">{{ 'sessions.details.price' | translate }}</p>
            <p class="text-base font-medium text-gray-900">
              {{ booking.currency || 'MYR' }} {{ booking.price | number:'1.2-2' }}
            </p>
          </div>
        </div>
      </div>

      <!-- Notes -->
      <div *ngIf="booking.notes" class="mt-6 pt-6 border-t border-gray-200">
        <p class="text-sm text-gray-600 mb-2 flex items-center gap-2">
          <lucide-angular [img]="FileTextIcon" size="16"></lucide-angular>
          {{ 'sessions.details.notes' | translate }}
        </p>
        <p class="text-sm text-gray-900 whitespace-pre-wrap">{{ booking.notes }}</p>
      </div>
    </div>

    <!-- Session Outcomes -->
    <div class="bg-white rounded-lg border border-gray-200 p-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
          <lucide-angular [img]="CheckCircleIcon" size="20" class="text-emerald-600"></lucide-angular>
          {{ 'sessions.details.outcomes' | translate }}
        </h2>
      </div>

      <!-- Loading Outcomes -->
      <div *ngIf="isLoadingOutcomes" class="flex justify-center py-8">
        <div class="inline-flex items-center space-x-3">
          <span class="h-6 w-6 border-2 border-[#2563EB] border-t-transparent rounded-full animate-spin"></span>
          <span class="text-sm text-gray-600">{{ 'common.loading' | translate }}</span>
        </div>
      </div>

      <!-- No Outcomes -->
      <div *ngIf="!isLoadingOutcomes && !caseUpdate" class="text-center py-8">
        <lucide-angular [img]="FileTextIcon" size="48" class="mx-auto text-gray-400 mb-4"></lucide-angular>
        <p class="text-sm text-gray-600">{{ 'sessions.details.noOutcomes' | translate }}</p>
      </div>

      <!-- Outcomes Content -->
      <div *ngIf="!isLoadingOutcomes && caseUpdate" class="space-y-6">
        <!-- Progress Summary -->
        <div *ngIf="caseUpdate.progress_summary">
          <h3 class="text-sm font-semibold text-gray-900 mb-2">{{ 'sessions.details.progressSummary' | translate }}</h3>
          <p class="text-sm text-gray-700 whitespace-pre-wrap bg-gray-50 p-4 rounded-lg">
            {{ caseUpdate.progress_summary }}
          </p>
        </div>

        <!-- Case Notes -->
        <div *ngIf="caseUpdate.case_notes">
          <h3 class="text-sm font-semibold text-gray-900 mb-2">{{ 'sessions.details.caseNotes' | translate }}</h3>
          <p class="text-sm text-gray-700 whitespace-pre-wrap bg-gray-50 p-4 rounded-lg">
            {{ caseUpdate.case_notes }}
          </p>
        </div>

        <!-- Goals -->
        <div *ngIf="getGoalsArray(caseUpdate.goals).length > 0">
          <h3 class="text-sm font-semibold text-gray-900 mb-2">{{ 'sessions.details.goals' | translate }}</h3>
          <ul class="list-disc list-inside space-y-2 bg-gray-50 p-4 rounded-lg">
            <li *ngFor="let goal of getGoalsArray(caseUpdate.goals)" class="text-sm text-gray-700">
              {{ goal }}
            </li>
          </ul>
        </div>

        <!-- Next Steps -->
        <div *ngIf="caseUpdate.next_steps">
          <h3 class="text-sm font-semibold text-gray-900 mb-2">{{ 'sessions.details.nextSteps' | translate }}</h3>
          <p class="text-sm text-gray-700 whitespace-pre-wrap bg-gray-50 p-4 rounded-lg">
            {{ caseUpdate.next_steps }}
          </p>
        </div>

        <!-- Attachments -->
        <div *ngIf="caseUpdate.attachments && caseUpdate.attachments.length > 0">
          <h3 class="text-sm font-semibold text-gray-900 mb-2">{{ 'sessions.details.attachments' | translate }}</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3">
            <a
              *ngFor="let attachment of caseUpdate.attachments"
              [href]="attachment.url"
              target="_blank"
              rel="noopener noreferrer"
              class="flex items-center gap-3 p-3 bg-gray-50 border border-gray-200 rounded-lg hover:bg-gray-100 transition-colors"
            >
              <lucide-angular [img]="getAttachmentIcon(attachment.type)" size="20" class="text-gray-600"></lucide-angular>
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-gray-900 truncate">{{ attachment.filename }}</p>
                <p class="text-xs text-gray-500">{{ attachment.type }}</p>
              </div>
            </a>
          </div>
        </div>

        <!-- Therapist Info -->
        <div *ngIf="caseUpdate.therapist_name" class="pt-4 border-t border-gray-200">
          <p class="text-xs text-gray-500">
            {{ 'sessions.details.updatedBy' | translate }} {{ caseUpdate.therapist_name }}
            <span *ngIf="caseUpdate.created_at">
              on {{ caseUpdate.created_at | date:'mediumDate' }}
            </span>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

