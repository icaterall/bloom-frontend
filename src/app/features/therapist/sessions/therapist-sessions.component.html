<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">{{ 'therapistSessions.title' | translate }}</h1>
    <p class="text-gray-600">{{ 'therapistSessions.subtitle' | translate }}</p>
  </div>

  <!-- Tabs -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
    <div class="border-b border-gray-200">
      <nav class="flex -mb-px">
        <button
          (click)="activeTab = 'list'"
          [class.border-[#2563EB]]="activeTab === 'list'"
          [class.text-[#2563EB]]="activeTab === 'list'"
          [class.border-gray-300]="activeTab !== 'list'"
          [class.text-gray-500]="activeTab !== 'list'"
          class="flex items-center gap-2 px-6 py-4 border-b-2 font-medium text-sm transition-colors"
        >
          <lucide-angular [img]="ListIcon" size="20"></lucide-angular>
          {{ 'therapistSessions.tabs.list' | translate }}
        </button>
        <button
          (click)="activeTab = 'calendar'"
          [class.border-[#2563EB]]="activeTab === 'calendar'"
          [class.text-[#2563EB]]="activeTab === 'calendar'"
          [class.border-gray-300]="activeTab !== 'calendar'"
          [class.text-gray-500]="activeTab !== 'calendar'"
          class="flex items-center gap-2 px-6 py-4 border-b-2 font-medium text-sm transition-colors"
        >
          <lucide-angular [img]="CalendarIcon" size="20"></lucide-angular>
          {{ 'therapistSessions.tabs.calendar' | translate }}
        </button>
      </nav>
    </div>

    <!-- Filters -->
    <div class="p-4 border-b border-gray-200 bg-gray-50">
      <div class="flex items-center justify-between mb-4">
        <button
          (click)="toggleFilters()"
          class="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium"
        >
          <lucide-angular [img]="FilterIcon" size="16"></lucide-angular>
          {{ 'therapistSessions.filters.title' | translate }}
        </button>
        <button
          *ngIf="showFilters"
          (click)="clearFilters()"
          class="flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-900 text-sm"
        >
          <lucide-angular [img]="XIcon" size="16"></lucide-angular>
          {{ 'therapistSessions.filters.clear' | translate }}
        </button>
      </div>

      <div *ngIf="showFilters" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <!-- Date Range -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            {{ 'therapistSessions.filters.dateRange' | translate }}
          </label>
          <select
            [(ngModel)]="dateRange"
            (change)="onFilterChange()"
            class="block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2563EB] focus:border-[#2563EB] sm:text-sm"
          >
            <option value="today">{{ 'therapistSessions.filters.today' | translate }}</option>
            <option value="week">{{ 'therapistSessions.filters.week' | translate }}</option>
            <option value="month">{{ 'therapistSessions.filters.month' | translate }}</option>
            <option value="custom">{{ 'therapistSessions.filters.custom' | translate }}</option>
          </select>
        </div>

        <!-- Custom Date Range -->
        <div *ngIf="dateRange === 'custom'" class="md:col-span-2">
          <div class="grid grid-cols-2 gap-2">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                {{ 'therapistSessions.filters.from' | translate }}
              </label>
              <input
                type="date"
                [(ngModel)]="customFromDate"
                (change)="onFilterChange()"
                class="block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2563EB] focus:border-[#2563EB] sm:text-sm"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                {{ 'therapistSessions.filters.to' | translate }}
              </label>
              <input
                type="date"
                [(ngModel)]="customToDate"
                (change)="onFilterChange()"
                class="block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2563EB] focus:border-[#2563EB] sm:text-sm"
              />
            </div>
          </div>
        </div>

        <!-- Status Filter -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            {{ 'therapistSessions.filters.status' | translate }}
          </label>
          <select
            [(ngModel)]="selectedStatus"
            (change)="onFilterChange()"
            class="block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2563EB] focus:border-[#2563EB] sm:text-sm"
          >
            <option *ngFor="let option of statusOptions" [value]="option.value">
              {{ option.labelKey | translate }}
            </option>
          </select>
        </div>

        <!-- Mode Filter -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            {{ 'therapistSessions.filters.mode' | translate }}
          </label>
          <select
            [(ngModel)]="selectedMode"
            (change)="onFilterChange()"
            class="block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2563EB] focus:border-[#2563EB] sm:text-sm"
          >
            <option *ngFor="let option of modeOptions" [value]="option.value">
              {{ option.labelKey | translate }}
            </option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex justify-center py-12">
    <div class="inline-flex items-center space-x-3">
      <span class="h-6 w-6 border-2 border-[#2563EB] border-t-transparent rounded-full animate-spin"></span>
      <span class="text-sm text-gray-600">{{ 'common.loading' | translate }}</span>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="bg-red-50 border border-red-200 rounded-lg p-6 mb-6">
    <div class="flex items-center gap-3">
      <lucide-angular [img]="AlertCircleIcon" size="24" class="text-red-600"></lucide-angular>
      <p class="text-red-700">{{ error }}</p>
    </div>
  </div>

  <!-- List View -->
  <div *ngIf="!isLoading && !error && activeTab === 'list'">
    <div *ngIf="filteredSessions.length === 0" class="bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center">
      <lucide-angular [img]="CalendarIcon" size="48" class="mx-auto text-gray-400 mb-4"></lucide-angular>
      <h3 class="text-lg font-semibold text-gray-900 mb-2">{{ 'therapistSessions.empty.title' | translate }}</h3>
      <p class="text-gray-600">{{ 'therapistSessions.empty.description' | translate }}</p>
    </div>

    <div *ngIf="filteredSessions.length > 0" class="grid grid-cols-1 gap-4">
      <div *ngFor="let session of filteredSessions" 
           class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-all">
        <div class="flex items-start justify-between gap-4">
          <div class="flex-1">
            <!-- Child Name + Age -->
            <div class="flex items-center gap-3 mb-3">
              <h3 class="text-xl font-semibold text-gray-900">
                {{ session.child_name }}
                <span *ngIf="session.child_dob" class="text-base font-normal text-gray-600">
                  ({{ getAge(session.child_dob) }} {{ 'therapistSessions.yearsOld' | translate }})
                </span>
              </h3>
              <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold border" [ngClass]="getStatusColor(session.status)">
                {{ getStatusLabel(session.status) | translate }}
              </span>
            </div>

            <!-- Confirmed Time + Duration -->
            <div class="flex items-center gap-2 mb-2 text-sm text-gray-600">
              <lucide-angular [img]="ClockIcon" size="16" class="text-gray-400"></lucide-angular>
              <span class="font-medium">
                {{ (session.confirmed_start_at || session.preferred_start_at) | date:'fullDate' }} 
                {{ (session.confirmed_start_at || session.preferred_start_at) | date:'shortTime' }}
              </span>
              <span *ngIf="session.confirmed_end_at || session.preferred_end_at" class="text-gray-500">
                â€¢ {{ getDuration(session.confirmed_start_at || session.preferred_start_at, session.confirmed_end_at || session.preferred_end_at) }}
              </span>
            </div>

            <!-- Mode + Location -->
            <div class="flex items-center gap-4 mb-3 text-sm text-gray-600">
              <div class="flex items-center gap-2">
                <lucide-angular [img]="session.mode === 'online' ? VideoIcon : MapPinIcon" size="16" class="text-gray-400"></lucide-angular>
                <span>
                  {{ session.mode === 'online' ? ('booking.mode.online' | translate) : ('booking.mode.inCentre' | translate) }}
                </span>
              </div>
              <div *ngIf="session.mode === 'in_centre' && session.location" class="flex items-center gap-2">
                <lucide-angular [img]="MapPinIcon" size="16" class="text-gray-400"></lucide-angular>
                <span>{{ session.location }}</span>
              </div>
            </div>

            <!-- Service Type -->
            <div class="text-sm text-gray-600">
              <span class="font-medium">{{ 'therapistSessions.service' | translate }}:</span>
              {{ session.booking_type_name || session.booking_type }}
            </div>
          </div>

          <!-- Actions -->
          <div class="flex flex-col gap-2">
            <a
              [routerLink]="['/therapist/sessions', session.id]"
              class="flex items-center justify-center gap-2 px-4 py-2 bg-[#2563EB] text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-semibold whitespace-nowrap"
            >
              <lucide-angular [img]="EyeIcon" size="16"></lucide-angular>
              {{ 'therapistSessions.actions.openDetails' | translate }}
            </a>
            <a
              *ngIf="canJoinSession(session)"
              [href]="session.online_meeting_link"
              target="_blank"
              rel="noopener noreferrer"
              class="flex items-center justify-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors text-sm font-semibold whitespace-nowrap"
            >
              <lucide-angular [img]="VideoIcon" size="16"></lucide-angular>
              {{ 'therapistSessions.actions.joinSession' | translate }}
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Calendar View (Placeholder) -->
  <div *ngIf="!isLoading && !error && activeTab === 'calendar'" class="bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center">
    <lucide-angular [img]="CalendarIcon" size="48" class="mx-auto text-gray-400 mb-4"></lucide-angular>
    <h3 class="text-lg font-semibold text-gray-900 mb-2">{{ 'therapistSessions.calendar.comingSoon' | translate }}</h3>
    <p class="text-gray-600">{{ 'therapistSessions.calendar.description' | translate }}</p>
  </div>
</div>

