<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Back Button -->
  <button (click)="goBack()" class="inline-flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6">
    <lucide-angular [img]="ArrowLeftIcon" size="18"></lucide-angular>
    <span>{{ 'common.back' | translate }}</span>
  </button>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex justify-center py-12">
    <div class="inline-flex items-center space-x-3">
      <span class="h-6 w-6 border-2 border-[#2563EB] border-t-transparent rounded-full animate-spin"></span>
      <span class="text-sm text-gray-600">{{ 'common.loading' | translate }}</span>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="bg-red-50 border border-red-200 rounded-lg p-6 mb-6">
    <div class="flex items-center gap-3">
      <lucide-angular [img]="AlertCircleIcon" size="24" class="text-red-600"></lucide-angular>
      <div>
        <h3 class="font-semibold text-red-900">{{ 'therapistChildProfile.error.title' | translate }}</h3>
        <p class="text-sm text-red-700 mt-1">{{ error }}</p>
      </div>
    </div>
  </div>

  <!-- Child Profile Content -->
  <div *ngIf="!isLoading && !error && child" class="space-y-6">
    <!-- Child Header -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="flex items-start justify-between mb-4">
        <div class="flex items-center gap-4">
          <div class="w-20 h-20 rounded-full bg-gradient-to-br from-blue-500 to-indigo-500 flex items-center justify-center text-white text-4xl font-semibold">
            {{ child.full_name.charAt(0).toUpperCase() }}
          </div>
          <div>
            <h1 class="text-3xl font-bold text-gray-900">{{ child.full_name }}</h1>
            <p class="text-gray-600 mt-1">
              {{ calculateAge(child.date_of_birth) }} {{ 'therapistChildProfile.yearsOld' | translate }}
              <span *ngIf="child.gender"> â€¢ {{ child.gender === 'male' ? ('therapistChildProfile.male' | translate) : ('therapistChildProfile.female' | translate) }}</span>
            </p>
          </div>
        </div>
        <button
          (click)="addUpdate()"
          class="inline-flex items-center gap-2 px-4 py-2 bg-[#2563EB] text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold"
        >
          <lucide-angular [img]="PlusIcon" size="18"></lucide-angular>
          <span>{{ 'therapistChildProfile.addUpdate' | translate }}</span>
        </button>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Child Details -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
          <lucide-angular [img]="UserIcon" size="20" class="text-[#2563EB]"></lucide-angular>
          {{ 'therapistChildProfile.childDetails' | translate }}
        </h2>
        <div class="space-y-3 text-sm">
          <div>
            <p class="text-gray-600">{{ 'therapistChildProfile.dateOfBirth' | translate }}</p>
            <p class="font-medium text-gray-900">{{ formatDate(child.date_of_birth) }}</p>
          </div>
          <div *ngIf="child.primary_language">
            <p class="text-gray-600">{{ 'therapistChildProfile.primaryLanguage' | translate }}</p>
            <p class="font-medium text-gray-900">{{ child.primary_language }}</p>
          </div>
          <div *ngIf="child.other_languages">
            <p class="text-gray-600">{{ 'therapistChildProfile.otherLanguages' | translate }}</p>
            <p class="font-medium text-gray-900">{{ child.other_languages }}</p>
          </div>
          <div *ngIf="child.school_status">
            <p class="text-gray-600">{{ 'therapistChildProfile.schoolStatus' | translate }}</p>
            <p class="font-medium text-gray-900">{{ child.school_status }}</p>
          </div>
        </div>
      </div>

      <!-- Parent Information -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
          <lucide-angular [img]="UserIcon" size="20" class="text-[#2563EB]"></lucide-angular>
          {{ 'therapistChildProfile.parentInfo' | translate }}
        </h2>
        <div class="space-y-3 text-sm">
          <div>
            <p class="text-gray-600">{{ 'therapistChildProfile.parentName' | translate }}</p>
            <p class="font-medium text-gray-900">{{ child.parent_name }}</p>
          </div>
          <div *ngIf="child.parent_email">
            <p class="text-gray-600 flex items-center gap-1">
              <lucide-angular [img]="MailIcon" size="14"></lucide-angular>
              {{ 'therapistChildProfile.email' | translate }}
            </p>
            <p class="font-medium text-gray-900">{{ child.parent_email }}</p>
          </div>
          <div *ngIf="child.parent_mobile">
            <p class="text-gray-600 flex items-center gap-1">
              <lucide-angular [img]="PhoneIcon" size="14"></lucide-angular>
              {{ 'therapistChildProfile.phone' | translate }}
            </p>
            <p class="font-medium text-gray-900">{{ child.parent_mobile }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Concerns/Diagnosis -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
        <lucide-angular [img]="AlertCircleIcon" size="20" class="text-[#2563EB]"></lucide-angular>
        {{ 'therapistChildProfile.concernsDiagnosis' | translate }}
      </h2>
      <div class="space-y-4 text-sm">
        <div>
          <p class="text-gray-600 mb-1">{{ 'therapistChildProfile.diagnosisStatus' | translate }}</p>
          <p class="font-medium text-gray-900">{{ getDiagnosisStatusLabel(child.diagnosis_status) | translate }}</p>
        </div>
        <div *ngIf="child.diagnosis_details">
          <p class="text-gray-600 mb-1">{{ 'therapistChildProfile.diagnosisDetails' | translate }}</p>
          <p class="text-gray-900 whitespace-pre-wrap">{{ child.diagnosis_details }}</p>
        </div>
        <div *ngIf="child.main_concerns">
          <p class="text-gray-600 mb-1">{{ 'therapistChildProfile.mainConcerns' | translate }}</p>
          <p class="text-gray-900 whitespace-pre-wrap">{{ child.main_concerns }}</p>
        </div>
        <div *ngIf="child.family_goals">
          <p class="text-gray-600 mb-1">{{ 'therapistChildProfile.familyGoals' | translate }}</p>
          <p class="text-gray-900 whitespace-pre-wrap">{{ child.family_goals }}</p>
        </div>
      </div>
    </div>

    <!-- Session History -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
        <lucide-angular [img]="CalendarIcon" size="20" class="text-[#2563EB]"></lucide-angular>
        {{ 'therapistChildProfile.sessionHistory' | translate }}
      </h2>
      <div *ngIf="sessions.length === 0" class="text-center py-8 text-gray-500">
        <p>{{ 'therapistChildProfile.noSessions' | translate }}</p>
      </div>
      <div *ngIf="sessions.length > 0" class="space-y-3">
        <div *ngFor="let session of sessions" class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-2">
                <span class="font-semibold text-gray-900">{{ session.booking_type_name || session.booking_type }}</span>
                <span class="inline-block px-2 py-1 rounded-full text-xs font-semibold border" [ngClass]="getStatusColor(session.status)">
                  {{ getStatusLabel(session.status) | translate }}
                </span>
              </div>
              <div class="space-y-1 text-sm text-gray-600">
                <p *ngIf="session.confirmed_start_at" class="flex items-center gap-1">
                  <lucide-angular [img]="ClockIcon" size="14"></lucide-angular>
                  <span>{{ formatDateTime(session.confirmed_start_at) }}</span>
                </p>
                <p *ngIf="!session.confirmed_start_at && session.preferred_start_at" class="flex items-center gap-1">
                  <lucide-angular [img]="ClockIcon" size="14"></lucide-angular>
                  <span>{{ 'therapistChildProfile.preferred' | translate }}: {{ formatDateTime(session.preferred_start_at) }}</span>
                </p>
                <p *ngIf="session.mode" class="flex items-center gap-1">
                  <lucide-angular [img]="session.mode === 'online' ? VideoIcon : MapPinIcon" size="14"></lucide-angular>
                  <span>{{ session.mode === 'online' ? ('therapistChildProfile.online' | translate) : ('therapistChildProfile.inCentre' | translate) }}</span>
                </p>
              </div>
            </div>
            <button
              [routerLink]="['/therapist/sessions', session.id]"
              class="text-[#2563EB] hover:text-blue-700 flex items-center gap-1 text-sm font-semibold"
            >
              <span>{{ 'therapistChildProfile.viewDetails' | translate }}</span>
              <lucide-angular [img]="ArrowLeftIcon" size="14" class="rotate-180"></lucide-angular>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Updates History -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
        <lucide-angular [img]="FileTextIcon" size="20" class="text-[#2563EB]"></lucide-angular>
        {{ 'therapistChildProfile.updatesHistory' | translate }}
      </h2>
      <div *ngIf="progressUpdates.length === 0" class="text-center py-8 text-gray-500">
        <p>{{ 'therapistChildProfile.noUpdates' | translate }}</p>
      </div>
      <div *ngIf="progressUpdates.length > 0" class="space-y-4">
        <div *ngFor="let update of progressUpdates" class="border border-gray-200 rounded-lg p-4">
          <div class="flex items-start justify-between mb-2">
            <div>
              <span class="inline-block px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-semibold mb-1">
                {{ getUpdateTypeLabel(update.update_type) | translate }}
              </span>
              <span *ngIf="update.status === 'draft'" class="inline-block px-2 py-1 bg-gray-100 text-gray-800 rounded text-xs font-semibold ml-2">
                {{ 'therapistChildProfile.draft' | translate }}
              </span>
              <h3 *ngIf="update.title" class="font-semibold text-gray-900 mt-2">{{ update.title }}</h3>
            </div>
            <span class="text-xs text-gray-500">{{ formatDate(update.created_at) }}</span>
          </div>
          <p class="text-sm text-gray-700 whitespace-pre-wrap mb-2">{{ update.body }}</p>
          <div *ngIf="update.media && update.media.length > 0" class="mt-2">
            <p class="text-xs text-gray-600 mb-1">{{ 'therapistChildProfile.attachments' | translate }}: {{ update.media.length }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

