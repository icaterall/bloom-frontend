<div class="min-h-screen bg-gray-50 flex">
  
  <!-- Mobile Backdrop -->
  <div *ngIf="isMobile && isSidebarOpen" 
       (click)="toggleSidebar()"
       class="fixed inset-0 bg-black/50 z-40 lg:hidden transition-opacity">
  </div>

  <!-- Sidebar -->
  <aside 
    class="fixed lg:static inset-y-0 left-0 z-50 bg-white border-r border-gray-200 transition-all duration-300 ease-in-out flex flex-col"
    [ngClass]="{
      'w-64': isSidebarOpen,
      'w-20': !isSidebarOpen && !isMobile,
      '-translate-x-full': !isSidebarOpen && isMobile,
      'translate-x-0': isSidebarOpen && isMobile
    }"
  >
    <!-- Logo Area -->
    <div class="h-16 flex items-center justify-center border-b border-gray-100 px-4" [ngClass]="{'justify-start': isSidebarOpen}">
      <a routerLink="/" class="flex items-center gap-3 overflow-hidden whitespace-nowrap">
        <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center flex-shrink-0 text-white font-bold text-xl">
          B
        </div>
        <span class="font-bold text-xl text-gray-800 transition-opacity duration-200"
              [class.opacity-0]="!isSidebarOpen && !isMobile"
              [class.hidden]="!isSidebarOpen && !isMobile">
          Bloom
        </span>
      </a>
    </div>

    <!-- Navigation Items -->
    <div class="flex-1 overflow-y-auto py-4 px-3 space-y-1">
      <a *ngFor="let item of menuItems" 
         [routerLink]="item.route"
         routerLinkActive="bg-blue-50 text-blue-600"
         class="flex items-center gap-3 px-3 py-2.5 rounded text-gray-600 hover:bg-gray-50 hover:text-gray-900 transition-colors group relative"
         [title]="!isSidebarOpen ? getMenuLabel(item) : ''">
        
        <span class="text-xl flex-shrink-0">{{ item.icon }}</span>
        
        <span class="font-medium whitespace-nowrap transition-opacity duration-200"
              [class.opacity-0]="!isSidebarOpen && !isMobile"
              [class.hidden]="!isSidebarOpen && !isMobile">
          {{ getMenuLabel(item) }}
        </span>

        <!-- Tooltip for collapsed state -->
        <div *ngIf="!isSidebarOpen && !isMobile" 
             class="absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity whitespace-nowrap z-50">
          {{ getMenuLabel(item) }}
        </div>
      </a>
    </div>

    <!-- Bottom Actions (User & Logout) -->
    <div class="p-3 border-t border-gray-100 space-y-1">
      <!-- User Profile -->
      <div class="flex items-center gap-3 px-3 py-2.5 rounded text-gray-600 transition-colors overflow-hidden">
        <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center flex-shrink-0 border border-gray-200">
          <span class="text-sm font-semibold text-gray-700">{{ (currentUser?.name || 'C').charAt(0).toUpperCase() }}</span>
        </div>
        <div class="flex-1 min-w-0" [class.hidden]="!isSidebarOpen && !isMobile">
          <p class="text-sm font-medium text-gray-900 truncate">{{ currentUser?.name }}</p>
          <p class="text-xs text-gray-500 truncate">Clinical Manager</p>
        </div>
      </div>

      <!-- Logout -->
      <button (click)="logout()" 
              class="w-full flex items-center gap-3 px-3 py-2.5 rounded text-red-600 hover:bg-red-50 transition-colors group relative">
        <span class="text-xl flex-shrink-0">ðŸšª</span>
        <span class="font-medium whitespace-nowrap transition-opacity duration-200"
              [class.opacity-0]="!isSidebarOpen && !isMobile"
              [class.hidden]="!isSidebarOpen && !isMobile">
          Logout
        </span>
        
        <!-- Tooltip -->
        <div *ngIf="!isSidebarOpen && !isMobile" 
             class="absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity whitespace-nowrap z-50">
          Logout
        </div>
      </button>
    </div>
  </aside>

  <!-- Main Content Wrapper -->
  <div class="flex-1 flex flex-col min-w-0 transition-all duration-300">
    
    <!-- Top Header -->
    <header class="bg-white border-b border-gray-200 h-16 flex items-center justify-between px-4 sm:px-6 lg:px-8 sticky top-0 z-30">
      <div class="flex items-center gap-4">
        <button (click)="toggleSidebar()" class="p-2 rounded hover:bg-gray-100 text-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-200">
          <span class="text-xl">{{ isSidebarOpen ? 'â—€' : 'â˜°' }}</span>
        </button>
        <h1 class="text-xl font-semibold text-gray-800 hidden sm:block">Clinical Manager Portal</h1>
      </div>

      <div class="flex items-center gap-3">
        <!-- Language Toggle -->
        <button (click)="toggleLanguage()" 
                class="flex items-center space-x-1 px-3 py-2 rounded hover:bg-gray-100 transition-colors duration-200"
                [title]="currentLanguage === 'my' ? 'Switch to English' : 'Tukar ke Bahasa Melayu'">
          <div class="flex items-center">
            <span class="text-xl leading-none transition-opacity duration-200" 
                  [class.opacity-100]="currentLanguage === 'en'" 
                  [class.opacity-40]="currentLanguage !== 'en'">ðŸ‡¬ðŸ‡§</span>
            <span class="mx-2 text-gray-300">|</span>
            <span class="text-xl leading-none transition-opacity duration-200" 
                  [class.opacity-100]="currentLanguage === 'my'" 
                  [class.opacity-40]="currentLanguage !== 'my'">ðŸ‡²ðŸ‡¾</span>
          </div>
        </button>

        <!-- Notifications -->
        <button class="p-2 rounded hover:bg-gray-100 text-gray-600 relative">
          <span class="text-xl">ðŸ””</span>
          <span class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></span>
        </button>

        <!-- User Profile Menu -->
        <div class="relative cm-user-menu">
          <button (click)="toggleUserMenu()"
                  class="flex items-center gap-2 px-2 py-1 rounded-full hover:bg-gray-100 transition-colors">
            <div class="w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center border border-gray-200">
              <span class="text-sm font-semibold text-gray-700">
                {{ (currentUser?.name || 'C').charAt(0).toUpperCase() }}
              </span>
            </div>
            <div class="hidden sm:flex flex-col items-start max-w-[160px]">
              <span class="text-sm font-medium text-gray-900 truncate">
                {{ currentUser?.name || 'Clinical Manager' }}
              </span>
              <span class="text-xs text-gray-500 truncate">
                {{ currentUser?.email }}
              </span>
            </div>
            <span class="text-xs text-gray-400">â–¼</span>
          </button>

          <!-- Dropdown -->
          <div *ngIf="isUserMenuOpen"
               class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-100 py-1 z-50">
            <button (click)="logout()"
                    class="w-full flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 text-left">
              <span class="text-lg">ðŸšª</span>
              <span>Logout</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Page Content -->
    <main class="flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto">
      <router-outlet></router-outlet>
    </main>

  </div>
</div>
