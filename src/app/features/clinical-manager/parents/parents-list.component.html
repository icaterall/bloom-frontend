<div class="parents-list-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div>
        <h1 class="page-title">Parents & Children</h1>
        <p class="page-subtitle">View all registered parents and their children</p>
      </div>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="search-section">
    <div class="search-container">
      <div class="search-icon-wrapper">
        <lucide-angular [img]="SearchIcon" class="search-icon"></lucide-angular>
      </div>
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (keyup.enter)="onSearch()"
        placeholder="Search by parent name, email, or child name..."
        class="search-input"
      />
      <div class="search-actions">
        <button
          *ngIf="searchTerm"
          (click)="onSearchClear()"
          class="btn-clear"
          type="button"
        >
          Clear
        </button>
        <button
          (click)="onSearch()"
          class="btn-search"
          type="button"
          [disabled]="isLoading"
        >
          Search
        </button>
      </div>
    </div>
    <div class="search-results-info" *ngIf="!isLoading">
      <span class="results-count">{{ total }} parent{{ total !== 1 ? 's' : '' }} found</span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-text">Loading parents...</p>
  </div>

  <!-- Parents List -->
  <div *ngIf="!isLoading" class="parents-grid">
    <div *ngFor="let parent of parents" class="parent-card">
      <!-- Parent Header -->
      <div class="parent-header">
        <div class="parent-avatar">
          <lucide-angular [img]="UserIcon" class="avatar-icon"></lucide-angular>
        </div>
        <div class="parent-info">
          <h3 class="parent-name">{{ parent.parent_name }}</h3>
          <div class="parent-meta">
            <span class="meta-item">
              <lucide-angular [img]="MailIcon" class="meta-icon"></lucide-angular>
              {{ parent.parent_email }}
            </span>
            <span class="meta-item" *ngIf="parent.parent_mobile">
              <lucide-angular [img]="PhoneIcon" class="meta-icon"></lucide-angular>
              {{ parent.parent_mobile }}
            </span>
          </div>
        </div>
        <div class="parent-badge">
          <lucide-angular [img]="UsersIcon" class="badge-icon"></lucide-angular>
          <span>{{ parent.children_count }} child{{ parent.children_count !== 1 ? 'ren' : '' }}</span>
        </div>
      </div>

      <!-- Children List -->
      <div class="children-section" *ngIf="parent.children && parent.children.length > 0">
        <h4 class="children-title">Children</h4>
        <div class="children-list">
          <div *ngFor="let child of parent.children" class="child-item">
            <div class="child-info">
              <div class="child-name">{{ child.full_name }}</div>
              <div class="child-details">
                <span class="child-detail-item">
                  <lucide-angular [img]="CalendarIcon" class="detail-icon"></lucide-angular>
                  Age: {{ calculateAge(child.date_of_birth) }} years
                </span>
                <span class="child-detail-item" *ngIf="child.gender">
                  • {{ child.gender | titlecase }}
                </span>
                <span class="child-detail-item" *ngIf="child.diagnosis_status">
                  • {{ child.diagnosis_status | titlecase }}
                </span>
                <span class="child-detail-item" *ngIf="child.child_status">
                  • Status: {{ child.child_status | titlecase }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="children-section empty" *ngIf="!parent.children || parent.children.length === 0">
        <p class="no-children">No children registered</p>
      </div>

      <!-- Parent Footer -->
      <div class="parent-footer">
        <div class="footer-info">
          <span class="footer-text">Registered: {{ formatDate(parent.parent_created_at) }}</span>
          <span class="footer-text" *ngIf="parent.parent_last_login">
            Last login: {{ formatDate(parent.parent_last_login) }}
          </span>
        </div>
        <div class="footer-actions">
          <button
            class="btn-view"
            (click)="viewParentDetails(parent.parent_id)"
          >
            <lucide-angular [img]="EyeIcon" class="btn-icon"></lucide-angular>
            View Details
          </button>
          <button
            class="btn-contact"
            [routerLink]="['/clinical-manager/contact/parent', parent.parent_id]"
          >
            <lucide-angular [img]="MailIcon" class="btn-icon"></lucide-angular>
            Contact
          </button>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="parents.length === 0" class="empty-state">
      <div class="empty-icon-wrapper">
        <lucide-angular [img]="UsersIcon" class="empty-icon"></lucide-angular>
      </div>
      <h3 class="empty-title">No parents found</h3>
      <p class="empty-message">
        <span *ngIf="searchTerm">No parents match your search criteria.</span>
        <span *ngIf="!searchTerm">No parents have registered yet.</span>
      </p>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="!isLoading && totalPages > 1" class="pagination">
    <button
      class="pagination-btn"
      [disabled]="currentPage === 1"
      (click)="goToPage(currentPage - 1)"
    >
      Previous
    </button>
    
    <div class="pagination-numbers">
      <button
        *ngFor="let page of getPageNumbers()"
        class="pagination-number"
        [class.active]="page === currentPage"
        (click)="goToPage(page)"
      >
        {{ page }}
      </button>
    </div>
    
    <button
      class="pagination-btn"
      [disabled]="currentPage === totalPages"
      (click)="goToPage(currentPage + 1)"
    >
      Next
    </button>
  </div>

  <!-- Parent Details Modal -->
  <div *ngIf="showParentModal" class="modal-overlay" (click)="closeParentModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Parent Details</h2>
        <button class="modal-close" (click)="closeParentModal()">
          <lucide-angular [img]="XIcon" class="close-icon"></lucide-angular>
        </button>
      </div>

      <div class="modal-body">
        <!-- Loading State -->
        <div *ngIf="isLoadingParentDetails" class="loading-container">
          <div class="loading-spinner"></div>
          <p class="loading-text">Loading parent details...</p>
        </div>

        <!-- Parent Details -->
        <div *ngIf="!isLoadingParentDetails && selectedParent" class="space-y-6">
          <!-- Parent Information -->
          <div class="parent-info-card">
            <h3 class="card-title">Parent Information</h3>
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">Name:</span>
                <span class="info-value">{{ selectedParent.parent_name }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Email:</span>
                <span class="info-value">{{ selectedParent.parent_email }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Mobile:</span>
                <span class="info-value">{{ selectedParent.parent_mobile || 'N/A' }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Registered:</span>
                <span class="info-value">{{ formatDate(selectedParent.parent_created_at) }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Last Login:</span>
                <span class="info-value">{{ selectedParent.parent_last_login ? formatDate(selectedParent.parent_last_login) : 'Never' }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Children Count:</span>
                <span class="info-value">{{ selectedParent.children_count || 0 }}</span>
              </div>
            </div>
          </div>

          <!-- Children List -->
          <div *ngIf="selectedParent.children && selectedParent.children.length > 0" class="children-details-card">
            <h3 class="card-title">Children ({{ selectedParent.children.length }})</h3>
            <div class="children-details-list">
              <div *ngFor="let child of selectedParent.children" class="child-detail-card">
                <div class="child-detail-header">
                  <h4 class="child-detail-name">{{ child.full_name }}</h4>
                  <span *ngIf="child.child_status" class="child-status-badge" [ngClass]="{
                    'status-not-enrolled': child.child_status === 'not_enrolled',
                    'status-in-assessment': child.child_status === 'in_assessment',
                    'status-enrolled': child.child_status === 'enrolled',
                    'status-waitlist': child.child_status === 'on_waitlist'
                  }">
                    {{ child.child_status.replace('_', ' ') | titlecase }}
                  </span>
                </div>
                <div class="child-detail-info">
                  <div class="detail-row">
                    <span class="detail-label">Age:</span>
                    <span class="detail-value">{{ calculateAge(child.date_of_birth) }} years</span>
                  </div>
                  <div class="detail-row" *ngIf="child.gender">
                    <span class="detail-label">Gender:</span>
                    <span class="detail-value">{{ child.gender | titlecase }}</span>
                  </div>
                  <div class="detail-row" *ngIf="child.date_of_birth">
                    <span class="detail-label">Date of Birth:</span>
                    <span class="detail-value">{{ formatDate(child.date_of_birth) }}</span>
                  </div>
                  <div class="detail-row" *ngIf="child.diagnosis_status">
                    <span class="detail-label">Diagnosis:</span>
                    <span class="detail-value">{{ child.diagnosis_status | titlecase }}</span>
                  </div>
                  <div class="detail-row" *ngIf="child.primary_language">
                    <span class="detail-label">Primary Language:</span>
                    <span class="detail-value">{{ child.primary_language }}</span>
                  </div>
                  <div class="detail-row" *ngIf="child.main_concerns">
                    <span class="detail-label">Main Concerns:</span>
                    <span class="detail-value">{{ child.main_concerns }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="!selectedParent.children || selectedParent.children.length === 0" class="no-children-card">
            <p class="no-children-text">No children registered for this parent</p>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeParentModal()">
          Close
        </button>
        <button
          *ngIf="selectedParent"
          class="btn-contact"
          [routerLink]="['/clinical-manager/contact/parent', selectedParent.parent_id]"
          (click)="closeParentModal()"
        >
          <lucide-angular [img]="MailIcon" class="btn-icon"></lucide-angular>
          Contact Parent
        </button>
      </div>
    </div>
  </div>
</div>

